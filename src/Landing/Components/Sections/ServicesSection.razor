@inject Landing.Services.ScrollService ScrollService
@using Landing.Models

<section class="section">
    <div class="container">
        <h2 class="section__title reveal">Nossos Servi√ßos</h2>
        
        <div class="grid reveal">
            @foreach (var service in Services)
            {
                <div class="card">
                    <div class="card__icon">@service.Icon</div>
                    <h3 class="card__title">@service.Title</h3>
                    <p class="card__text">@service.Description</p>
                    <div class="card__actions">
                        <button class="btn btn--primary" type="button" @onclick="() => OpenLeadModal(service)">
                            @service.ButtonText
                        </button>
                        <button class="btn btn--outline" type="button" @onclick="() => ContactForService(service.Title)">
                            WhatsApp
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- Modal de Lead -->
@if (_selectedService != null)
{
    <div class="modal-overlay" @onclick="CloseLeadModal">
        <div class="modal-content" @onclick:stopPropagation>
            <button class="modal-close" @onclick="CloseLeadModal">&times;</button>
            <div class="modal-header">
                <h2>Interesse em @_selectedService.Title</h2>
                <p>Preencha o formul√°rio abaixo e entraremos em contato sobre este servi√ßo!</p>
            </div>
            <div class="modal-body">
                <LeadForm Source="@($"Servi√ßo: {_selectedService.Title}")" ServiceInterest="@_selectedService.Title" OnSubmitted="HandleLeadSubmitted" />
            </div>
        </div>
    </div>
}

@code {
    private ServiceCard? _selectedService;

    private List<ServiceCard> Services = new()
    {
        new() { Icon = "üåê", Title = "Desenvolvimento de Sites", Description = "Sites modernos, r√°pidos e responsivos. Do layout at√© o lan√ßamento, cuidamos de tudo para voc√™.", ButtonText = "Quero um Site" },
        new() { Icon = "üìä", Title = "Sistema de Analytics Pr√≥prio", Description = "Tenha seus pr√≥prios dados, sem limites e com privacidade total.", ButtonText = "Quero Analytics" },
        new() { Icon = "üöÄ", Title = "Automa√ß√£o de Marketing", Description = "Automatize emails, capta√ß√£o de leads e funis de venda. Mais resultados com menos esfor√ßo.", ButtonText = "Quero Automa√ß√£o" },
        new() { Icon = "üí¨", Title = "Chat ao Vivo", Description = "Converse com seus clientes em tempo real. Widget personaliz√°vel e integrado ao seu sistema.", ButtonText = "Quero Chat" },
        new() { Icon = "üîó", Title = "Integra√ß√µes", Description = "Conecte pagamentos, e-mail e ferramentas de IA para tudo funcionar junto automaticamente.", ButtonText = "Quero Integra√ß√µes" },
        new() { Icon = "üë•", Title = "CRM Completo", Description = "Gerencie leads, contatos e campanhas em um s√≥ lugar. Simples, poderoso e f√°cil de usar.", ButtonText = "Quero CRM" }
    };

    private async Task ContactForService(string serviceName)
    {
        var message = $"Ol√°! Tenho interesse em {serviceName}. Podemos conversar?";
        var url = ScrollService.BuildWhatsAppUrl("5511987654321", message);
        await ScrollService.OpenNewTabAsync(url);
    }

    private void OpenLeadModal(ServiceCard service)
    {
        _selectedService = service;
    }

    private void CloseLeadModal()
    {
        _selectedService = null;
    }

    private void HandleLeadSubmitted()
    {
        _selectedService = null;
        // Opcional: mostrar mensagem de sucesso
    }
}
